!function(r){"use strict";function o(r,o){return r<<o|r>>>32-o}function t(r,o){var t=r[o+3];return t=t<<8|r[o+2],t=t<<8|r[o+1],t<<8|r[o+0]}function n(r,o,t){var n;for(n=0;4>n;n++)r[o+n]=255&t,t>>>=8}function e(r,e,f,c,u){var i,a,s,p=[],_=[],h=[],y=[];for(i=0;4>i;i++)_[5*i]=t(c,4*i),_[1+i]=t(f,4*i),_[6+i]=t(e,4*i),_[11+i]=t(f,16+4*i);for(i=0;16>i;i++)h[i]=_[i];for(i=0;20>i;i++){for(a=0;4>a;a++){for(s=0;4>s;s++)y[s]=_[(5*a+4*s)%16];for(y[1]^=o(0|y[0]+y[3],7),y[2]^=o(0|y[1]+y[0],9),y[3]^=o(0|y[2]+y[1],13),y[0]^=o(0|y[3]+y[2],18),s=0;4>s;s++)p[4*a+(a+s)%4]=y[s]}for(s=0;16>s;s++)_[s]=p[s]}if(u){for(i=0;16>i;i++)_[i]=0|_[i]+h[i];for(i=0;4>i;i++)_[5*i]=0|_[5*i]-t(c,4*i),_[6+i]=0|_[6+i]-t(e,4*i);for(i=0;4>i;i++)n(r,4*i,_[5*i]),n(r,16+4*i,_[6+i])}else for(i=0;16>i;i++)n(r,4*i,0|_[i]+h[i])}function f(r,o,t,n){e(r,o,t,n,!1)}function c(r,o,t,n){e(r,o,t,n,!0)}function u(r,o,t,n,e,c,u){var i,a,s=[],p=[];if(e){for(a=0;16>a;a++)s[a]=0;for(a=0;8>a;a++)s[a]=c[a];for(;e>=64;){for(f(p,s,u,C),a=0;64>a;a++)r[o+a]=(t?t[n+a]:0)^p[a];for(i=1,a=8;16>a;++a)i=0|i+s[a],s[a]=i,i>>>=8;e-=64,o+=64,t&&(n+=64)}if(e>0)for(f(p,s,u,C),a=0;e>a;a++)r[o+a]=(t?t[n+a]:0)^p[a]}}function i(r,o,t,n,e){u(r,o,null,0,t,n,e)}function a(r,o,t,n,e){var f,u=[],a=[];for(c(u,n,e,C),f=0;8>f;f++)a[f]=n[16+f];i(r,o,t,a,u)}function s(r,o,t,n,e,f,i){var a,s=[],p=[];for(c(s,f,i,C),a=0;8>a;a++)p[a]=f[16+a];u(r,o,t,n,e,p,s)}function p(r,o,t,n,e,f){var c,u,i,a,s=function(r,o){var t,n=0;for(t=0;17>t;t++)n=0|n+(0|r[t]+o[t]),r[t]=255&n,n>>>=8},p=[5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,252],_=[],h=[],y=[],l=[],v=[];for(i=0;17>i;i++)h[i]=y[i]=0;for(i=0;16>i;i++)h[i]=f[i];for(h[3]&=15,h[4]&=252,h[7]&=15,h[8]&=252,h[11]&=15,h[12]&=252,h[15]&=15;e>0;){for(i=0;17>i;i++)l[i]=0;for(i=0;16>i&&e>i;++i)l[i]=t[n+i];for(l[i]=1,n+=i,e-=i,s(y,l),u=0;17>u;u++)for(_[u]=0,i=0;17>i;i++)_[u]+=0|y[i]*(u>=i?h[u-i]:0|320*h[u+17-i]);for(u=0;17>u;u++)y[u]=_[u];for(a=0,i=0;16>i;i++)a=0|a+y[i],y[i]=255&a,a>>>=8;for(a=0|a+y[16],y[16]=3&a,a=0|5*(a>>>2),i=0;16>i;i++)a=0|a+y[i],y[i]=255&a,a>>>=8;a=0|a+y[16],y[16]=a}for(i=0;17>i;i++)v[i]=y[i];for(s(y,p),c=0|-(y[16]>>>7),i=0;17>i;i++)y[i]^=c&(v[i]^y[i]);for(i=0;16>i;i++)l[i]=f[i+16];for(l[16]=0,s(y,l),i=0;16>i;i++)r[o+i]=y[i]}function _(r,o,t,n,e){var f,c=0;for(f=0;e>f;f++)c|=r[o+f]^t[n+f];return(1&c-1>>>8)-1}function h(r,o,t,n){return _(r,o,t,n,16)}function y(r,o,t,n){return _(r,o,t,n,32)}function l(r,o,t,n,e,f){var c=[];return p(c,0,t,n,e,f),h(r,o,c,0)}function v(r,o,t,n,e){var f;if(32>t)throw new Error("crypto_secretbox: d < 32");for(s(r,0,o,0,t,n,e),p(r,16,r,32,t-32,r),f=0;16>f;f++)r[f]=0}function b(r,o,t,n,e){var f,c=[];if(32>t)throw new Error("crypto_secretbox_open: d < 32");if(a(c,0,32,n,e),0!=l(o,16,o,32,t-32,c))return!1;for(s(r,0,o,0,t,n,e),f=0;32>f;f++)r[f]=0;return!0}function d(r){var o,t=[];for(r=unescape(encodeURIComponent(r)),o=0;o<r.length;o++)t.push(r.charCodeAt(o));return t}function x(r){var o,t=[];for(o=0;o<r.length;o++)t.push(String.fromCharCode(r[o]));return decodeURIComponent(escape(t.join("")))}function g(r){return"string"==typeof r?d(r):r}function w(r){var o,t=[],n=r.length;if("undefined"==typeof btoa)return new Buffer(r).toString("base64");for(o=0;n>o;o++)t.push(String.fromCharCode(r[o]));return btoa(t.join(""))}function E(r){var o,t=[];if("undefined"==typeof atob)return Array.prototype.slice.call(new Buffer(r,"base64"),0);for(r=atob(r),o=0;o<r.length;o++)t.push(r.charCodeAt(o));return t}function m(r,o){if(r.length!=B)throw new Error("bad key length");if(o.length!=S)throw new Error("bad nonce length")}var C=[101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107],B=32,S=24,Y=32,O=16;r.crypto_stream_xor=s,r.crypto_stream=a,r.crypto_stream_salsa20_xor=u,r.crypto_stream_salsa20=i,r.crypto_onetimeauth=p,r.crypto_onetimeauth_verify=l,r.crypto_verify_16=h,r.crypto_verify_32=y,r.crypto_secretbox=v,r.crypto_secretbox_open=b,r.crypto_secretbox_KEYBYTES=B,r.crypto_secretbox_NONCEBYTES=S,r.crypto_secretbox_ZEROBYTES=Y,r.crypto_secretbox_BOXZEROBYTES=O,r.secretbox=r.secretbox||{},r.secretbox.seal=function(r,o,t){var n,e,f,c=[],u=[];for(n=0;Y>n;n++)c.push(0);return c=c.concat(g(r)),e=g(t),f=g(o),m(e,f),v(u,c,c.length,f,e),w(u.slice(O))},r.secretbox.open=function(r,o,t){var n,e,f,c=[],u=[];for(n=0;O>n;n++)u.push(0);try{u=u.concat(E(r))}catch(i){return!1}return u.length<32?!1:(e=g(t),f=g(o),m(e,f),b(c,u,u.length,f,e)?x(c.slice(Y)):!1)}}("undefined"!=typeof exports?exports:window.nacl=window.nacl||{});